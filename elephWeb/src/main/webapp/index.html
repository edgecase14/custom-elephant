<!DOCTYPE html>
<html lang=en>
<head>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<script type="module">

var sock = new WebSocket("ws://localhost:8080/elephWeb/Tsc");
var sockStatus = document.getElementById("tsc");
console.log(sockStatus.innerText);
sockStatus.innerText = "setup";

sock.onopen = function (event) {
  sockStatus.innerText = "is open";
};

sock.onmessage = function (event) {
  console.log(event.data);
  if (true) {  
    console.log("unknown tsc event");
  };
};

const registerWsListener = function (tsc, tsid) {
	
};

class TimeSheetCell extends HTMLElement {

   // Can define constructor arguments if you wish.
  constructor() {
    // If you define a constructor, always call super() first!
    // This is specific to CE and required by the spec.
    super();
    
    //console.log(":yey:");

    this.addEventListener("keydown", (e) => {
       if (e.keyCode == '13') {
          console.log("oh no you di-int");
	  	  this.className = "";
	      this.className = "bloody";
	      e.preventDefault();
	      this.blur();
	  
	      let cell_id = this.getAttribute("timesheet-id");
	      let contents = this.querySelector("div").innerText;
	      console.log(contents);
	      sock.send("cell-update", { contents: contents, id: cell_id });

	      setTimeout(() => {
	         // fire our lazers!!!
	         console.log("ONE. SECOND. LATER.");
	     	this.ack();
	  	  }, 3000);
	  	  return false;
       }
    });
    

    // Setup a click listener on <app-drawer> itself.
    this.addEventListener('click', e => {
      console.log("i got the click");
    });
  } // constructor !!

    ack() {
       this.className = "rolling-meadows";
        let myid = this.getAttribute("timesheet-id");
        console.log("saved id : " + myid);
    }
    connectedCallback() {
      if (this.hasAttribute("timesheet-id")) {
        let myid = this.getAttribute("timesheet-id");
        console.log("my id is : " + myid);
	    this.innerHTML = `<div contenteditable=true id=$myid>0</div>`;
		registerWsListener(sock, myid);
      }
    }

}

customElements.define('ts-cell', TimeSheetCell);
</script>
<style>
   ts-cell {
      margin: .5em;
      display: inline-block;
      border: 1px solid #ddd;
      font-family: arial;
      background-color: black;
      color: goldenrod;
   }
   ts-cell div {
      padding: 10px;
      max-width: 8em;
      text-overflow: elipsis;
   }
   ts-cell.foobar {
      background-color: white;
      color: black;
   }
   ts-cell.bloody {
     background-color: red;
     color: white;
   }
   ts-cell.rolling-meadows {
     background-color: #88ef99;
     color: black;
   }
</style>


</head>

<body>

<p id="tsc">unknown</p>
<ts-cell timesheet-id="42"></ts-cell>
<ts-cell timesheet-id="12"></ts-cell>
<ts-cell timesheet-id="7"></ts-cell>
<ts-cell timesheet-id="69" nice></ts-cell>
<ts-cell timesheet-id="420"></ts-cell>
<ts-cell timesheet-id="9001"></ts-cell>
<ts-cell timesheet-id="0"></ts-cell>

</body>
</html>

